# docker/Dockerfile.dev
FROM python:3.9-slim-bullseye

WORKDIR /app

# 1) Install Poetry & your dev-deps (skip packaging your library)
COPY pyproject.toml poetry.lock README.md ./
RUN pip install poetry \
  && poetry config virtualenvs.create false \
  && poetry install --no-interaction --no-ansi --no-root

# 2) Copy your library source
COPY src /app/src

# 3) Make Python import from /app/src
ENV PYTHONPATH=/app/src

# 4) Copy your config folder (YAMLs + entrypoint + .env.example, etc)
COPY config /app/config

# 5) Normalize line endings & mark entrypoint executable
RUN sed -i 's/\r$//' /app/config/entrypoint.sh \
  && chmod +x /app/config/entrypoint.sh

# 6) Expose port & launch in dev mode
EXPOSE 8000
ENTRYPOINT ["./config/entrypoint.sh"]
CMD ["uvicorn", "ml_ids_analyzer.api.app:app", "--reload", "--host", "0.0.0.0", "--port", "8000"]
