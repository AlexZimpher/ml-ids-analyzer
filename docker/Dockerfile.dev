 FROM python:3.9-slim-bullseye
 WORKDIR /app

 # 1) Copy pyproject.toml & poetry.lock so that Poetry can install dependencies & your package
 COPY pyproject.toml poetry.lock README.md /app/

 # 2) Copy source code and config so that Poetry can find your package and config files
 COPY src /app/src
 COPY config /app/config

 # 3) Install Poetry, install dependencies (including your package, since pyproject.toml is in /app)
 RUN pip install --upgrade pip \
     && pip install poetry \
     && poetry config virtualenvs.create false \
     && poetry install --no-interaction --no-ansi

 # 4) Install the local package (using the pyproject.toml in /app)
 RUN pip install -e /app

 # 5) Make entrypoint script executable
 RUN chmod +x /app/config/entrypoint.sh

 ENTRYPOINT ["/app/config/entrypoint.sh"]
 CMD ["uvicorn", "ml_ids_analyzer.api.app:app", "--host", "0.0.0.0", "--port", "8000"]
